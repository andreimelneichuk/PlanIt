# Документация по API диспетчера задач

Этот проект представляет собой API диспетчера задач на основе FastAPI, который поддерживает аутентификацию пользователей и CRUD-операции для задач. API использует PostgreSQL для хранения данных, Redis для кэширования токенов обновления и Docker Compose для управления сервисами. Функции проекта включают регистрацию пользователей, аутентификацию и управление задачами (создание, извлечение, обновление и удаление задач). 

## Содержание
1. [Обзор проекта](#обзор-проекта)
2. [Используемые технологии](#используемые-технологии)
3. [Начало работы](#начало-работы)
4. [Endpoints](#endpoints)
    - [Аутентификация](#аутентификация)
    - [Управление задачами](#управление-задачами)
5. [Переменные окружения](#переменные-окружения)


---

## Обзор проекта

API диспетчера задач - это серверное приложение, которое позволяет пользователям управлять своими задачами после регистрации и аутентификации в системе. Каждый пользователь может создавать, читать, обновлять и удалять свои задачи. API поддерживает аутентификацию на основе токенов с помощью токенов доступа и обновления. Redis используется для управления токенами обновления, в то время как PostgreSQL служит основной базой данных.

## Используемые технологии

- **FastAPI**: Веб-платформа, используемая для создания RESTful API.
- **PostgreSQL**: Реляционная база данных, используемая для хранения пользовательских данных и данных задач.
- **Redis**: Используется для кэширования и управления токенами обновления.
- **Docker Compose**: Используется для управления контейнерами.
- **SQLAlchemy**: ORM для асинхронного взаимодействия с базой данных PostgreSQL.
- **Перегонный куб**: Используется для миграции баз данных.
- **JWT**: веб-токены JSON для безопасной аутентификации пользователей.
- **uvicorn**: ASGI-сервер для запуска приложения FastAPI.

---

## Начало работы

Чтобы настроить и запустить этот проект локально, выполните следующие действия:

1. **Клонировать репозиторий**
   ```bash
    git clone <url-адрес репозитория>
    cd <каталог репозитория>
   ```

2. **Настройка переменных среды**

   Создайте файл `.env` со следующими переменными или обновите `docker-compose.yml` напрямую:
   - `DATABASE_URL`: строка подключения к базе данных.
   - `REDIS_URL`: строка подключения к Redis.

3. **Создавайте и запускайте контейнеры с помощью Docker Compose**
   ```bash
    docker-compose up -d
   ```

   Эта команда запустит:
   - контейнеры приложений PostgreSQL, Redis и FastAPI.
   - Создаст необходимые таблицы базы данных.

4. **Запуск миграции базы данных.**
   Убедитесь, что ваши таблицы созданы в соответствии с моделями:
   ```обновление bash
    docker-compose exec web alembic head
   ```

5. **Получите доступ к API**
   API будет доступен по адресу "http://localhost:8000". Документация предоставляется через Swagger по адресу `http://localhost:8000/docs`.

---

## Endpoints

### Аутентификация

- **POST** `/auth/register`: Зарегистрировать нового пользователя.
  - Текст запроса: `{ "username": "<логин>", "password": "<пароль>" }`
  - Ответ: Токен доступа.

- **POST** `/auth/login`: Войдите в систему с существующей учетной записью пользователя.
  - Текст запроса: `{ "username": "<логин>", "password": "<пароль>" }`
  - Ответ: токены доступа и обновления.

- **POST** `/auth/refresh`: Обновите токен доступа с помощью токена обновления.
  - Текст запроса: `{ "refresh_token": "<обновление_тока>" }`
  - Ответ: Новый токен доступа.

### Управление задачами

- **POST** `/tasks/`: Создать новую задачу.
  - Заголовки запроса: `Authorization: Bearer <access_token>`
  - Текст запроса: `{ "title": "<название>", "description": "<описание>", "status": "<статус>" }`
  - Ответ: Подробные сведения о задаче.

- **GET** `/tasks/`: Получить все задачи для текущего пользователя.
  - Заголовки запроса: `Authorization: Bearer <access_token>`
  - Ответ: Список задач.

- **PUT** `/tasks/{task_id}`: Обновление существующей задачи.
  - Заголовки запроса: `Authorization: Bearer <access_token>`
  - Текст запроса: `{"title": "<название>", "description":  "<описание>", "status": "<статус>" }`
  - Ответ: Обновлены сведения о задаче.

- **DELETE** `/tasks/{task_id}`: Удалить задачу.
  - Заголовки запроса: `Authorization: Bearer <access_token>`
  - Ответ: HTTP 204 Нет содержимого при успешном удалении.

---

## Переменные окружения

Для этого проекта требуются следующие переменные окружения:

- **DATABASE_URL**: URL-адрес для подключения к базе данных PostgreSQL, например:
  ```
  DATABASE_URL=postgresql+asyncpg://postgres:password@db/tasks_db
  ```

- **REDIS_URL**: URL-адрес для подключения к экземпляру Redis, например:
  ```
  REDIS_URL=redis://redis:6379/0
  ```

- **SECRET_KEY**: Секретный ключ для кодирования токена JWT.
- **ACCESS_TOKEN_EXPIRE_MINUTES**: Время истечения срока действия токенов доступа в минутах.
- **REFRESH_TOKEN_EXPIRE_MINUTES**: Время истечения срока действия токенов обновления в минутах.

